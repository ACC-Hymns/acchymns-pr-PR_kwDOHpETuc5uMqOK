var G=Object.defineProperty;var U=(u,t,s)=>t in u?G(u,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[t]=s;var A=(u,t,s)=>(U(u,typeof t!="symbol"?t+"":t,s),s);import{d as W,o as K,a as Q,f as X,r as M,L as P,$ as Y,c as Z,g as tt,a0 as st,a1 as et,a2 as ot,a3 as nt,n as at,i as it,T as rt,j as x,k as i,a4 as lt,a5 as ct,l as C,F as j,q as V,t as R,p as q,s as I,w as H,v as L,m as ht,y as _t,R as N,I as dt,J as ut,A as pt}from"./index-e0bdf4b5.js";import{_ as mt}from"./home-outline-15dad159.js";const ft="/acchymns-pr-PR_kwDOHpETuc5zAJ8i/assets/filter-outline.svg",gt="/acchymns-pr-PR_kwDOHpETuc5zAJ8i/assets/search.svg";class J{constructor(t,s,o){A(this,"r",0);A(this,"g",0);A(this,"b",0);this.set(t,s,o)}toString(){return`rgb(${Math.round(this.r)}, ${Math.round(this.g)}, ${Math.round(this.b)})`}set(t,s,o){this.r=this.clamp(t),this.g=this.clamp(s),this.b=this.clamp(o)}hueRotate(t=0){t=t/180*Math.PI;const s=Math.sin(t),o=Math.cos(t);this.multiply([.213+o*.787-s*.213,.715-o*.715-s*.715,.072-o*.072+s*.928,.213-o*.213+s*.143,.715+o*.285+s*.14,.072-o*.072-s*.283,.213-o*.213-s*.787,.715-o*.715+s*.715,.072+o*.928+s*.072])}grayscale(t=1){this.multiply([.2126+.7874*(1-t),.7152-.7152*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152+.2848*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152-.7152*(1-t),.0722+.9278*(1-t)])}sepia(t=1){this.multiply([.393+.607*(1-t),.769-.769*(1-t),.189-.189*(1-t),.349-.349*(1-t),.686+.314*(1-t),.168-.168*(1-t),.272-.272*(1-t),.534-.534*(1-t),.131+.869*(1-t)])}saturate(t=1){this.multiply([.213+.787*t,.715-.715*t,.072-.072*t,.213-.213*t,.715+.285*t,.072-.072*t,.213-.213*t,.715-.715*t,.072+.928*t])}multiply(t){const s=this.clamp(this.r*t[0]+this.g*t[1]+this.b*t[2]),o=this.clamp(this.r*t[3]+this.g*t[4]+this.b*t[5]),n=this.clamp(this.r*t[6]+this.g*t[7]+this.b*t[8]);this.r=s,this.g=o,this.b=n}brightness(t=1){this.linear(t)}contrast(t=1){this.linear(t,-(.5*t)+.5)}linear(t=1,s=0){this.r=this.clamp(this.r*t+s*255),this.g=this.clamp(this.g*t+s*255),this.b=this.clamp(this.b*t+s*255)}invert(t=1){this.r=this.clamp((t+this.r/255*(1-2*t))*255),this.g=this.clamp((t+this.g/255*(1-2*t))*255),this.b=this.clamp((t+this.b/255*(1-2*t))*255)}hsl(){const t=this.r/255,s=this.g/255,o=this.b/255,n=Math.max(t,s,o),l=Math.min(t,s,o);let _=0,v=0;const p=(n+l)/2;if(n===l)_=v=0;else{const d=n-l;switch(v=p>.5?d/(2-n-l):d/(n+l),n){case t:_=(s-o)/d+(s<o?6:0);break;case s:_=(o-t)/d+2;break;case o:_=(t-s)/d+4;break}_/=6}return{h:_*100,s:v*100,l:p*100}}clamp(t){return t>255?t=255:t<0&&(t=0),t}}class vt{constructor(t){A(this,"target");A(this,"targetHSL");A(this,"reusedColor");this.target=t,this.targetHSL=t.hsl(),this.reusedColor=new J(0,0,0)}solve(){const t=this.solveNarrow(this.solveWide());return{values:t.values,loss:t.loss,filter:this.css(t.values??[])}}solveWide(){const o=[60,180,18e3,600,1.2,1.2];let n={loss:1/0};for(let l=0;n.loss>25&&l<3;l++){const _=[50,20,3750,50,100,100],v=this.spsa(5,o,15,_,1e3);v.loss<n.loss&&(n=v)}return n}solveNarrow(t){const s=t.loss,o=2,n=s+1,l=[.25*n,.25*n,n,.25*n,.2*n,.2*n];return this.spsa(s,l,o,t.values,500)}spsa(t,s,o,n,l){const v=.16666666666666666;let p=null,d=1/0;const S=new Array(6),b=new Array(6),y=new Array(6);for(let h=0;h<l;h++){const m=o/Math.pow(h+1,v);for(let c=0;c<6;c++)S[c]=Math.random()>.5?1:-1,b[c]=n[c]+m*S[c],y[c]=n[c]-m*S[c];const f=this.loss(b)-this.loss(y);for(let c=0;c<6;c++){const T=f/(2*m)*S[c],e=s[c]/Math.pow(t+h+1,1);n[c]=z(n[c]-e*T,c)}const O=this.loss(n);O<d&&(p=n.slice(0),d=O)}return{values:p,loss:d};function z(h,m){let f=100;return m===2?f=7500:(m===4||m===5)&&(f=200),m===3?h>f?h%=f:h<0&&(h=f+h%f):h<0?h=0:h>f&&(h=f),h}}loss(t){const s=this.reusedColor;s.set(0,0,0),s.invert(t[0]/100),s.sepia(t[1]/100),s.saturate(t[2]/100),s.hueRotate(t[3]*3.6),s.brightness(t[4]/100),s.contrast(t[5]/100);const o=s.hsl();return Math.abs(s.r-this.target.r)+Math.abs(s.g-this.target.g)+Math.abs(s.b-this.target.b)+Math.abs(o.h-this.targetHSL.h)+Math.abs(o.s-this.targetHSL.s)+Math.abs(o.l-this.targetHSL.l)}css(t){function s(o,n=1){return Math.round(t[o]*n)}return`filter: invert(${s(0)}%) sepia(${s(1)}%) saturate(${s(2)}%) hue-rotate(${s(3,3.6)}deg) brightness(${s(4)}%) contrast(${s(5)}%);`}}function bt(u){const t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;u=u.replace(t,(o,n,l,_)=>n+n+l+l+_+_);const s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(u);return s?[parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16)]:null}const kt=i("h1",{class:"pagetitle"},"Search",-1),yt={class:"search-bar"},wt=i("button",{disabled:""},[i("svg",{viewBox:"0 0 1024 1024"},[i("path",{class:"path1",d:"M848.471 928l-263.059-263.059c-48.941 36.706-110.118 55.059-177.412 55.059-171.294 0-312-140.706-312-312s140.706-312 312-312c171.294 0 312 140.706 312 312 0 67.294-24.471 128.471-55.059 177.412l263.059 263.059-79.529 79.529zM189.623 408.078c0 121.364 97.091 218.455 218.455 218.455s218.455-97.091 218.455-218.455c0-121.364-103.159-218.455-218.455-218.455-121.364 0-218.455 97.091-218.455 218.455z"})])],-1),$t={class:"filters"},Mt=i("p",{class:"dropdown-text"},"Filters",-1),St=i("img",{class:"ionicon filter-icon",src:ft},null,-1),At=[Mt,St],Ct=["src"],Lt=i("div",{class:"dropdown-content-text"},"All Hymnals",-1),Ft=["onClick"],Dt={class:"dropdown-content-item"},xt=["src"],Bt={class:"dropdown-content-text"},Rt={key:0,style:{"margin-top":"10px","margin-bottom":"10px"}},Ht={class:"songlist"},Nt={class:"song__title"},Ot={class:"book__title"},Tt={class:"booktext--right"},It={class:"song__number"},zt=i("div",{class:"song__title"},"Show more",-1),Pt=[zt],jt={class:"nav"},Et=i("img",{class:"ionicon nav__icon",src:mt},null,-1),Vt=i("span",{class:"nav__text"},"Home",-1),qt=i("img",{class:"ionicon nav__icon--active",src:gt},null,-1),Jt=i("span",{class:"nav__text"},"Search",-1),Gt=i("img",{class:"ionicon nav__icon",src:dt},null,-1),Ut=i("span",{class:"nav__text"},"Bookmarks",-1),Wt=i("img",{class:"ionicon nav__icon",src:ut},null,-1),Kt=i("span",{class:"nav__text"},"Settings",-1),E=50,Zt=W({__name:"SearchView",setup(u){K((e,r)=>{pt(r.fullPath)});const t=Q(),s=X("searchParams",{search:"",bookFilters:[]}),o=M(s.value.search),n=P(()=>o.value.replace(/[.,/#!$%^&*;:{}=\-_'"`~()]/g,"").replace(/s{2,}/g," ").toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,""));Y(o,e=>{s.value.search=e});const l=M([]),_=M([]),v=M(new Map),p=P(()=>s.value.bookFilters.length>0?l.value.filter(e=>{var r,a;return(((r=e.stripped_title)==null?void 0:r.includes(n.value))||((a=e==null?void 0:e.stripped_first_line)==null?void 0:a.includes(n.value))||(e==null?void 0:e.number)==n.value)&&s.value.bookFilters.find(w=>w==e.book.name.short)}).sort((e,r)=>e.title.replace(/[.,/#!$%^&*;:{}=\-_'"`~()]/g,"").localeCompare(r.title.replace(/[.,/#!$%^&*;:{}=\-_'"`~()]/g,""))):o.value===""?[]:l.value.filter(e=>{var r,a;return((r=e.stripped_title)==null?void 0:r.includes(n.value))||((a=e==null?void 0:e.stripped_first_line)==null?void 0:a.includes(n.value))||(e==null?void 0:e.number)==n.value}).sort((e,r)=>e.title.replace(/[.,/#!$%^&*;:{}=\-_'"`~()]/g,"").localeCompare(r.title.replace(/[.,/#!$%^&*;:{}=\-_'"`~()]/g,"")))),d=M(E),S=P(()=>p.value.length-d.value<E?p.value:p.value.slice(0,d.value));Z(async()=>{var a,w,B,F,k;const e=await tt(),r=await st();_.value.push(...Object.values(e));for(const $ of Object.keys(r))for(const D of Object.keys(r[$])){let g=r[$][D];g.title==null&&(g.title=""),l.value.push({title:(g==null?void 0:g.title)??"",number:D,book:e[$],stripped_title:g.title.replace(/[.,/#!$%^&*;:{}=\-_'"`~()]/g,"").replace(/s{2,}/g," ").toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,""),stripped_first_line:((k=(F=(B=(w=(a=g==null?void 0:g.first_line)==null?void 0:a.replace(/[.,/#!$%^&*;:{}=\-_'"`~()]/g,""))==null?void 0:w.replace(/s{2,}/g," "))==null?void 0:B.toLowerCase())==null?void 0:F.normalize("NFD"))==null?void 0:k.replace(/\p{Diacritic}/gu,""))??""})}et.concat(Object.keys(ot)).forEach(async $=>{let D=await nt($);D!=null&&v.value.set($,D)}),await at(),it(t.fullPath)});const b=M();var y=!1;function z(){var e,r;(e=b.value)!=null&&e.classList.contains("dropdown-content-active")&&!y&&((r=b.value)==null||r.classList.remove("dropdown-content-active")),y=!1}function h(){var e,r,a;(e=b.value)!=null&&e.classList.contains("dropdown-content-active")?((r=b.value)==null||r.classList.remove("dropdown-content-active"),y=!1):(y=!0,(a=b.value)==null||a.classList.add("dropdown-content-active"))}let m=M([]),f=M();function O(e){if(y=!0,s.value.bookFilters.includes(e)){let r=s.value.bookFilters.findIndex(a=>a==e);s.value.bookFilters.splice(r,1)}else s.value.bookFilters.push(e)}function c(){s.value.bookFilters=[]}function T(e){return e?"./assets/checkmark-circle.svg":"./assets/ellipse-outline.svg"}return rt(async()=>{var r,a,w,B;for(var e=0;e<((r=m.value)==null?void 0:r.length);e++){const F=(w=(a=m.value)==null?void 0:a.at(e))==null?void 0:w.children[0].children[0],k=bt(((B=_.value.at(e))==null?void 0:B.primaryColor)??"#000000");if((k==null?void 0:k.length)!==3){alert("Invalid format!");return}const $=new J(k[0],k[1],k[2]),g=new vt($).solve();F==null||F.setAttribute("style",`${g.filter}`)}}),(e,r)=>(L(),x(j,null,[i("div",{onClick:z,class:"blocker"},[kt,i("div",yt,[lt(i("input",{"onUpdate:modelValue":r[0]||(r[0]=a=>o.value=a),placeholder:"Search for a song title or number...","aria-label":"Search through site content"},null,512),[[ct,o.value]]),wt]),i("div",$t,[i("a",{onClick:r[1]||(r[1]=a=>h()),class:"dropdown"},At),i("div",{class:"dropdown-content",ref_key:"filter_content",ref:b},[i("a",null,[i("div",{class:"dropdown-content-top-item",ref_key:"all_hymnals_filter",ref:f,onClick:c},[i("img",{class:"ionicon checkmark-icon",src:T(C(s).bookFilters.length==0)},null,8,Ct),Lt],512)]),(L(!0),x(j,null,V(_.value,a=>(L(),x("a",{key:a.name.medium,onClick:w=>O(a.name.short),ref_for:!0,ref_key:"book_filters",ref:m},[i("div",Dt,[i("img",{class:"ionicon",src:T(C(s).bookFilters.includes(a.name.short))},null,8,xt),i("div",Bt,R(a.name.medium),1)])],8,Ft))),128))],512)]),p.value.length>0?(L(),x("h2",Rt,"Search Results ("+R(p.value.length)+")",1)):q("",!0),i("div",Ht,[(L(!0),x(j,null,V(S.value,a=>(L(),ht(C(N),{key:a.title+a.number+a.book.name.short,to:`/display/${a.book.name.short}/${a.number}`,class:"song",style:_t(`background: linear-gradient(135deg, ${a.book.primaryColor}, ${a.book.secondaryColor})`)},{default:H(()=>[i("div",null,[i("div",Nt,R(a.title),1),i("div",Ot,R(a.book.name.medium),1)]),i("div",Tt,[i("div",It,"#"+R(a.number),1)])]),_:2},1032,["to","style"]))),128)),S.value.length<p.value.length?(L(),x("div",{key:0,onClick:r[2]||(r[2]=a=>d.value+=E),class:"song",style:{background:"var(--blue)","justify-content":"center"}},Pt)):q("",!0)])]),i("nav",jt,[I(C(N),{to:"/",class:"nav__link"},{default:H(()=>[Et,Vt]),_:1}),I(C(N),{to:"/search",class:"nav__link nav__link--active"},{default:H(()=>[qt,Jt]),_:1}),I(C(N),{to:"/bookmarks",class:"nav__link"},{default:H(()=>[Gt,Ut]),_:1}),I(C(N),{to:"/settings",class:"nav__link"},{default:H(()=>[Wt,Kt]),_:1})])],64))}});export{Zt as default};
