import{d as j,r as S,ai as q,b as z,L as T,aj as l,T as J,j as c,k as e,a4 as G,a5 as K,p as m,F as k,q as C,s as x,w as p,l as r,a2 as H,v as a,m as D,af as P,Q as b,a9 as Q,R as E,E as Y,G as X,ak as N,H as Z,I as tt,Y as B,al as et,am as st,an as nt,ao as ot,ap as at,aq as it,ae as lt,ar as ct,K as rt}from"./index-e0bdf4b5.js";import{_ as dt}from"./chevron-back-outline-421b5681.js";import{_ as ut}from"./close-d0f54bcc.js";import{_ as _t}from"./home-outline-15dad159.js";import{_ as mt}from"./settings-9037a77f.js";import{T as i}from"./index-0984ecc2.js";import{u as pt}from"./navigator-47de01ae.js";import{u as ht}from"./preferences-a700b486.js";const ft="/acchymns-pr-PR_kwDOHpETuc5zAJ8i/assets/enter-outline.svg",vt="/acchymns-pr-PR_kwDOHpETuc5zAJ8i/assets/arrow-down-circle-outline.svg",wt="/acchymns-pr-PR_kwDOHpETuc5zAJ8i/assets/trash-outline.svg",o=v=>(Y("data-v-48732881"),v=v(),X(),v),yt={class:"menu"},gt={class:"title"},kt=o(()=>e("h1",{class:"title--center"},"Import Hymnals",-1)),xt={class:"main-content"},Dt={class:"input-option reference-option"},bt=["disabled"],Et=o(()=>e("img",{class:"ionicon enter-button-icon",src:ft},null,-1)),It=[Et],St={key:0},Tt={key:1,class:"warning-label-container"},Ct=o(()=>e("img",{class:"ionicon warning-icon",src:N},null,-1)),Pt=o(()=>e("h5",{class:"warning-label"},"The hymnals below require an internet connection",-1)),$t=[Ct,Pt],Ot=["onClick"],Rt=o(()=>e("img",{class:"ionicon ionicon-custom booktext--right add-button-icon",src:ct},null,-1)),Ht=[Rt],Bt={key:2},Nt={key:3,class:"warning-label-container"},At=o(()=>e("img",{class:"ionicon warning-icon",src:N},null,-1)),Vt=o(()=>e("h5",{class:"warning-label"},"The hymnals below require an internet connection",-1)),Lt=[At,Vt],Mt={class:"button-array"},Ut=["onClick"],Ft=o(()=>e("img",{class:"ionicon ionicon-custom add-button-icon",src:vt},null,-1)),Wt=[Ft],jt=["onClick"],qt=o(()=>e("img",{class:"ionicon ionicon-custom add-button-icon",src:ut},null,-1)),zt=[qt],Jt={key:4},Gt={class:"button-array"},Kt=["onClick"],Qt=o(()=>e("img",{class:"ionicon ionicon-custom add-button-icon",src:wt},null,-1)),Yt=[Qt],Xt=o(()=>e("div",{style:{"padding-bottom":"200px"}},null,-1)),Zt={class:"nav"},te=o(()=>e("img",{class:"ionicon nav__icon",src:_t},null,-1)),ee=o(()=>e("span",{class:"nav__text"},"Home",-1)),se=o(()=>e("img",{class:"ionicon nav__icon",src:Z},null,-1)),ne=o(()=>e("span",{class:"nav__text"},"Search",-1)),oe=o(()=>e("img",{class:"ionicon nav__icon",src:tt},null,-1)),ae=o(()=>e("span",{class:"nav__text"},"Bookmarks",-1)),ie=o(()=>e("img",{class:"ionicon nav__icon--active",src:mt},null,-1)),le=o(()=>e("span",{class:"nav__text"},"Settings",-1)),ce=j({__name:"SettingsImportView",setup(v){pt();let d=S(new Map),h=S(new Map);q(async()=>{h.value.forEach(async(t,n)=>{await t.cancel(),d.value.delete(n)})});const f=ht("bookSources",[]);let $=z("import_books_tooltip_complete",!1);const w=T(()=>f.value.filter(n=>n.status==l.PREVIEW)),I=T(()=>f.value.filter(t=>t.status==l.IMPORTED)),O=T(()=>f.value.filter(t=>t.status==l.DOWNLOADED)),y=S("");async function R(t,n=!0){let s=f.value.find(_=>_.id==t.id);if(s==null)return!1;if((await B.getStatus()).connected)b.getPlatform()!=="web"&&await et(s);else return await i.show({text:"No internet connection."}),!1;let g=null;try{const _=new AbortController,W=setTimeout(()=>_.abort(),2e3);g=await fetch(s.src+"/summary.json",{method:"HEAD",signal:_.signal}),clearTimeout(W)}catch(_){if(_.name=="TypeError")return await i.show({text:"Failed to load hymnal!"}),!1;if(_.name!="AbortError")throw _}return g==null||!g.ok||g.status!=200?(await i.show({text:"Failed to load hymnal!"}),!1):s.status!=l.IMPORTED?(s.status=l.IMPORTED,n&&await i.show({text:"Successfully imported hymnal!"}),!0):(await i.show({text:"Hymnal already imported!"}),!1)}async function A(t){if(t in H){const n=f.value.find(s=>s.id==t);if(n==null)return;n.status==l.IMPORTED||n.status==l.DOWNLOADED?await i.show({text:`Hymnal (${t}) already imported!`}):await R(n,!1)&&await i.show({text:`Successfully imported hymnal (${t})!`})}else await i.show({text:`Unknown hymnal reference (${t})!`})}async function V(t){if((await B.getStatus()).connected){let n=st(t,(s,u)=>L(s,u),(s,u)=>M(s,u));h.value.set(t.id,n)}else await i.show({text:"No internet connection."});console.log("Downloads:",h.value)}async function L(t,n){d.value.set(t.id,n)}async function M(t,n){t.src=n,t.status=l.DOWNLOADED,await i.show({text:"Successfully downloaded hymnal!"})}J(()=>{$.value||($.value=!0)});async function U(t){var n;t.status=Object.keys(nt).includes(t.id)?l.PREVIEW:l.HIDDEN,h.value.has(t.id)&&((n=h.value.get(t.id))==null||n.cancel(),d.value.delete(t.id)),b.getPlatform()!=="web"&&await ot(t),await i.show({text:"Successfully removed hymnal!"})}async function F(t){t.status=l.IMPORTED,t.src=H[t.id],await at.rmdir({directory:it.Documents,path:`Hymnals/${t.id}`,recursive:!0}),d.value.delete(t.id),lt(),await i.show({text:"Successfully deleted hymnal!"})}return(t,n)=>(a(),c(k,null,[e("div",yt,[e("div",gt,[e("img",{onClick:n[0]||(n[0]=s=>t.$router.back()),class:"ionicon title--left",src:dt}),kt])]),e("div",xt,[e("div",Dt,[G(e("input",{"onUpdate:modelValue":n[1]||(n[1]=s=>y.value=s),type:"text",class:"search-bar",placeholder:"Reference"},null,512),[[K,y.value,void 0,{trim:!0}]]),e("a",{disabled:y.value.length===0,onClick:n[2]||(n[2]=s=>A(y.value)),class:"reference-button"},It,8,bt)]),w.value.length!=0?(a(),c("h2",St,"Available Hymnals")):m("",!0),w.value.length!=0?(a(),c("div",Tt,$t)):m("",!0),e("div",null,[(a(!0),c(k,null,C(w.value,s=>(a(),D(P,{key:s.id,src:s.src,"with-link":!1},{default:p(()=>[e("button",{onClick:u=>R(s)},Ht,8,Ot)]),_:2},1032,["src"]))),128))]),I.value.length!=0?(a(),c("h2",Bt,"Imported Hymnals")):m("",!0),I.value.length!=0&&w.value.length==0?(a(),c("div",Nt,Lt)):m("",!0),e("div",null,[(a(!0),c(k,null,C(I.value,s=>(a(),D(P,{id:"import-book",key:s.id,src:s.src,"with-link":!1},{default:p(()=>[e("div",Mt,[(r(d).get(s.id)||0)<1&&r(b).getPlatform()!=="web"?(a(),c("button",{key:0,onClick:u=>V(s)},Wt,8,Ut)):m("",!0),(r(d).get(s.id||"")||0)>=1&&(r(d).get(s.id||"")||0)<100&&r(b).getPlatform()!=="web"?(a(),D(Q,{key:1,radius:15,progress:r(d).get(s.id||"")||0,stroke:3,transform:"rotate(-90) translate(-25 -8)"},null,8,["progress","transform"])):m("",!0),e("button",{onClick:u=>U(s)},zt,8,jt)])]),_:2},1032,["src"]))),128))]),O.value.length!=0?(a(),c("h2",Jt,"Downloaded Hymnals")):m("",!0),e("div",null,[(a(!0),c(k,null,C(O.value,s=>(a(),D(P,{id:"import-book",key:s.id,src:s.src,"with-link":!1},{default:p(()=>[e("div",Gt,[e("button",{onClick:u=>F(s)},Yt,8,Kt)])]),_:2},1032,["src"]))),128))]),Xt]),e("nav",Zt,[x(r(E),{to:"/",class:"nav__link"},{default:p(()=>[te,ee]),_:1}),x(r(E),{to:"/search",class:"nav__link"},{default:p(()=>[se,ne]),_:1}),x(r(E),{to:"/bookmarks",class:"nav__link"},{default:p(()=>[oe,ae]),_:1}),x(r(E),{to:"/settings",class:"nav__link nav__link--active"},{default:p(()=>[ie,le]),_:1})])],64))}});const ve=rt(ce,[["__scopeId","data-v-48732881"]]);export{ve as default};
